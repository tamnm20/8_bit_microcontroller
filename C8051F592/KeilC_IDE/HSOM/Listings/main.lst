C51 COMPILER V9.51   MAIN                                                                  07/17/2024 16:40:36 PAGE 1   


C51 COMPILER V9.51, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN .\Objects\main.obj
COMPILER INVOKED BY: C:\Keil\C51\BIN\C51.EXE main.c LARGE OMF2 ROM(COMPACT) OPTIMIZE(8,SPEED) BROWSE ORDER DEBUG PRINT(.
                    -\Listings\main.lst) TABS(2) OBJECT(.\Objects\main.obj)

line level    source

   1          #include <compiler_defs.h>             // Compiler declarations
   2          #include <C8051F580.h>
*** WARNING C317 IN LINE 34 OF C:\Keil\C51\Inc\Cygnal\C8051F580.h: attempt to redefine macro 'SFR'
*** WARNING C317 IN LINE 35 OF C:\Keil\C51\Inc\Cygnal\C8051F580.h: attempt to redefine macro 'SFR16'
*** WARNING C317 IN LINE 36 OF C:\Keil\C51\Inc\Cygnal\C8051F580.h: attempt to redefine macro 'SBIT'
   3          #include <string.h>
   4          //-----------------------------------------------------------------------------
   5          // Global CONSTANTS
   6          //-----------------------------------------------------------------------------
   7          #define SYSCLK       24000000        // SYSCLK frequency in Hz
   8          SBIT(TEST, P1, 3);
   9          //-----------------------------------------------------------------------------
  10          // Function PROTOTYPES
  11          //-----------------------------------------------------------------------------
  12          void SYSTEM_Init (void);
  13          void PORT_Init (void);
  14          void PCA0_Init (void);
  15          void delay(U16 ms);
  16          void delay_test(U16 test);
  17          //#define ISR_PCA0
  18          //----------------------------------------------------------------------------
  19          // MAIN Routine
  20          //-----------------------------------------------------------------------------
  21          void main (void)
  22          {
  23   1          SFRPAGE = ACTIVE_PAGE;
  24   1          PCA0MD &= ~(1 << 6);                   // Disable the watchdog timer
  25   1          SYSTEM_Init();                        // Configure system clock
  26   1          PORT_Init ();                           // Congigure pin
  27   1          PCA0_Init();
  28   1          EA = 1;                                 // Enable global interrupts
  29   1         while (1)
  30   1         {
  31   2      #ifndef ISR_PCA0
  32   2           if(CCF0){
  33   3            CCF0 = 0;
  34   3            PCA0L = 0;                       // Reset PCA Counter Value to 0x0000
  35   3           }
  36   2      #endif
  37   2         }                        
  38   1      }
  39          
  40          void SYSTEM_Init(void)
  41          {
  42   1         U8 SFRPAGE_save = SFRPAGE;
  43   1         SFRPAGE = CONFIG_PAGE;
  44   1         CLKSEL &= ~(3<< 0) ;       // choose internal oscillator   
  45   1         OSCICN |= (2<<6) | (7<<0); // config clock internal oscillator devided by 1
  46   1         SFRPAGE = SFRPAGE_save;
  47   1      }
  48          void PORT_Init (void)
  49          {
  50   1            U8 SFRPAGE_save = SFRPAGE;
  51   1            SFRPAGE = CONFIG_PAGE;
C51 COMPILER V9.51   MAIN                                                                  07/17/2024 16:40:36 PAGE 2   

  52   1            
  53   1            P1MDOUT |= (1<<3);    // Push-pull
  54   1            P0SKIP    = 0xFF;
  55   1            P1SKIP    = 0x07;
  56   1            XBR1    = 1<<2 ;
  57   1            XBR2    |= (1<<6);    // Enable crossbar and weak pull-ups
  58   1      
  59   1            SFRPAGE = SFRPAGE_save;
  60   1      }
  61          
  62          void PCA0_Init (void){
  63   1            U8 SFRPAGE_save = SFRPAGE;
  64   1            SFRPAGE = ACTIVE_PAGE;
  65   1            PCA0CN = 0x00;// Stop counter; clear all flags
  66   1            PCA0MD |= (1 << 3); // PCA0 pulse select system clock
  67   1            PCA0CPL0 = 0x03;
  68   1            PCA0CPM0 = 0x4D;
  69   1            EIE1 |= 0x08; 
  70   1            PCA0CN |= 1 << 6; //  PCA0 Counter/Timer enabled.
  71   1            SFRPAGE = SFRPAGE_save;
  72   1      }
  73          #ifdef ISR_PCA0
              INTERRUPT(PCA0_ISR, INTERRUPT_PCA0)
              {
                CCF0 = 0;
                PCA0L = 0;                       // Reset PCA Counter Value to 0x0000
                PCA0H = 0;
              }
              #endif
  81          
  82          /*
  83          Lí do vì sao lai 430k hz là max :
  84            + chu kì max là 12Mhz
  85            + moi lan vao ngat thi mat 27 chu ki xung 
  86          */


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =     89    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
   EDATA SIZE       =   ----    ----
   HDATA SIZE       =   ----    ----
   XDATA CONST SIZE =   ----    ----
   FAR CONST SIZE   =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  3 WARNING(S),  0 ERROR(S)
