C51 COMPILER V9.51   MAIN                                                                  07/16/2024 16:20:51 PAGE 1   


C51 COMPILER V9.51, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN .\Objects\main.obj
COMPILER INVOKED BY: C:\Keil\C51\BIN\C51.EXE main.c LARGE OMF2 ROM(COMPACT) OPTIMIZE(8,SPEED) BROWSE ORDER DEBUG PRINT(.
                    -\Listings\main.lst) TABS(2) OBJECT(.\Objects\main.obj)

line level    source

   1          #include <compiler_defs.h>             // Compiler declarations
   2          #include <C8051F580.h>
*** WARNING C317 IN LINE 34 OF C:\Keil\C51\Inc\Cygnal\C8051F580.h: attempt to redefine macro 'SFR'
*** WARNING C317 IN LINE 35 OF C:\Keil\C51\Inc\Cygnal\C8051F580.h: attempt to redefine macro 'SFR16'
*** WARNING C317 IN LINE 36 OF C:\Keil\C51\Inc\Cygnal\C8051F580.h: attempt to redefine macro 'SBIT'
   3          #include <string.h>
   4          //-----------------------------------------------------------------------------
   5          // Global CONSTANTS
   6          //-----------------------------------------------------------------------------
   7          #define SYSCLK       24000000        // SYSCLK frequency in Hz
   8          //#define ISR_PCA0
   9          SBIT(TEST, P1, 3);
  10          //-----------------------------------------------------------------------------
  11          // Function PROTOTYPES
  12          //-----------------------------------------------------------------------------
  13          U32 G_count = 0;
  14          void SYSTEM_Init (void);
  15          void PORT_Init (void);
  16          void PCA0_Init (void);
  17          void delay(U16 ms);
  18          void delay_test(U16 test);
  19          //----------------------------------------------------------------------------
  20          // MAIN Routine
  21          //-----------------------------------------------------------------------------
  22          void main (void)
  23          {
  24   1          SFRPAGE = ACTIVE_PAGE;
  25   1          PCA0MD &= ~(1 << 6);                   // Disable the watchdog timer
  26   1          SYSTEM_Init();                        // Configure system clock
  27   1          PORT_Init ();                           // Congigure pin
  28   1          PCA0_Init();
  29   1          EA = 1;                                 // Enable global interrupts
  30   1         while (1)
  31   1         {
  32   2           TEST = ~TEST;
  33   2           delay(200);
  34   2         }                        
  35   1      }
  36          void SYSTEM_Init(void)
  37          {
  38   1         U8 SFRPAGE_save = SFRPAGE;
  39   1         SFRPAGE = CONFIG_PAGE;
  40   1         CLKSEL &= ~(3<< 0) ;       // choose internal oscillator   
  41   1         OSCICN |= (2<<6) | (7<<0); // congig clock internal oscillator devided by 1
  42   1         SFRPAGE = SFRPAGE_save;
  43   1      }
  44          void PORT_Init (void)
  45          {
  46   1            U8 SFRPAGE_save = SFRPAGE;
  47   1            SFRPAGE = CONFIG_PAGE;
  48   1      
  49   1            P1MDOUT |= (1<<3);    // Push-pull
  50   1            P1SKIP  |= (1<<3);    // Skip P1.3
  51   1        
C51 COMPILER V9.51   MAIN                                                                  07/16/2024 16:20:51 PAGE 2   

  52   1            XBR2    |= (1<<6);    // Enable crossbar and weak pull-ups
  53   1        
  54   1            SFRPAGE = SFRPAGE_save;
  55   1      }
  56          
  57          #ifndef ISR_PCA0 
  58          void PCA0_Init (void){
  59   1            U8 SFRPAGE_save = SFRPAGE;
  60   1            SFRPAGE   = CONFIG_PAGE;
  61   1            //PCA0PWM   = 1<<6;
  62   1            PCA0PWM |= (3 << 0);
  63   1            SFRPAGE = ACTIVE_PAGE;
  64   1            PCA0CN = 0x00;          // Stop counter; clear all flags
  65   1            PCA0MD &= ~(7 << 1); // PCA0 pulse select system clock/12
  66   1            PCA0L = 0x2f ;
  67   1            EIE1 |= (1 <<3 );                       // Enable PCA interrupts
  68   1            PCA0CN |= 1 << 6; //  PCA0 Counter/Timer enabled.
  69   1            SFRPAGE = SFRPAGE_save;
  70   1      }
  71          void delay(U16 ms){
  72   1            int i = 0 ; 
  73   1            U8 SFRPAGE_save = SFRPAGE;
  74   1            SFRPAGE = CONFIG_PAGE;
  75   1            for( i = 0 ; i < ms ; ){
  76   2              if(((PCA0PWM >> 5)&1)==1){
  77   3                PCA0PWM &= ~(1<<5);
  78   3                i++;
  79   3                PCA0L = 0x2f ;
  80   3              }
  81   2          }
  82   1            SFRPAGE = SFRPAGE_save;
  83   1      }
  84          #else
              void PCA0_Init (void){
                    U8 SFRPAGE_save = SFRPAGE;
                    SFRPAGE   = CONFIG_PAGE;
                    PCA0PWM   = 1<<6;
                    PCA0PWM |= (3 << 0);
                    SFRPAGE = ACTIVE_PAGE;
                    PCA0CN = 0x00;          // Stop counter; clear all flags
                    PCA0MD &= ~(7 << 1); // PCA0 pulse select system clock/12
                    PCA0L = 0x2f ;
                    EIE1 |= (1 <<3 );  // Enable PCA interrupts
                    PCA0CN |= 1 << 6; //  PCA0 Counter/Timer enabled.
                    SFRPAGE = SFRPAGE_save;
              }
              void delay(U16 ms){
                    G_count =0 ; 
                    while(G_count < ms);
              }
              INTERRUPT(PCA0_ISR, INTERRUPT_PCA0){
                  U8 SFRPAGE_save = SFRPAGE;
                  PCA0L = 0x2F; 
                  G_count++;
                  SFRPAGE = CONFIG_PAGE;
                  PCA0PWM &= ~(1<<5);
                  SFRPAGE = SFRPAGE_save;
              }
              
              #endif


C51 COMPILER V9.51   MAIN                                                                  07/16/2024 16:20:51 PAGE 3   

MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    129    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =      4    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
   EDATA SIZE       =   ----    ----
   HDATA SIZE       =   ----    ----
   XDATA CONST SIZE =   ----    ----
   FAR CONST SIZE   =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  3 WARNING(S),  0 ERROR(S)
