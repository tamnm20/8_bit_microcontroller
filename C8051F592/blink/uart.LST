C51 COMPILER V9.59.0.0   UART                                                              01/05/2024 11:16:31 PAGE 1   


C51 COMPILER V9.59.0.0, COMPILATION OF MODULE UART
OBJECT MODULE PLACED IN uart.OBJ
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.exe uart.c DB OE BR INCDIR(C:\SiLabs\MCU\Inc)

line level    source

   1          //-----------------------------------------------------------------------------
   2          // F580_UART1_STDIO.c
   3          //-----------------------------------------------------------------------------
   4          // Copyright 2008 Silicon Laboratories, Inc.
   5          // http://www.silabs.com
   6          //
   7          // Program Description:
   8          //
   9          // This program demonstrates how to configure the C8051F580 to use routines
  10          // in STDIO.h to write to and read from the UART interface.  The program
  11          // reads a character using the STDIO routine getkey(), outputs that character
  12          // to the screen, and then outputs the ASCII hex value of that character.
  13          //
  14          //
  15          // How To Test:
  16          //
  17          // 1) Ensure that jumpers are placed on J? of the C8051F580 target board
  18          //    that connect P0.4 to the TX signal, and P0.5 to the RX field.
  19          // 2) Connect USB cable from the development board to a PC
  20          // 3) Specify the target baudrate in the constant <BAUDRATE>.
  21          // 4) Open Hyperterminal, or a similar program, and connect to the target
  22          //    board's USB port (virtual com port).
  23          // 5) Download and execute code to an 'F580 target board.
  24          //
  25          //
  26          // Target:         C8051F580
  27          // Tool chain:     Keil C51 8.0 / Keil EVAL C51
  28          // Command Line:   None
  29          //
  30          // Release 1.0 / 21 JUL 2008 (ADT)
  31          //    - Initial Revision
  32          //
  33          //-----------------------------------------------------------------------------
  34          // Includes
  35          //-----------------------------------------------------------------------------
  36          
  37          #include <compiler_defs.h>
  38          #include <C8051F580_defs.h>            // SFR declarations
  39          #include <stdio.h>
  40          
  41          //-----------------------------------------------------------------------------
  42          // Global CONSTANTS
  43          //-----------------------------------------------------------------------------
  44          
  45          #define SYSCLK      24000000           // SYSCLK frequency in Hz
  46          #define BAUDRATE      115200           // Baud rate of UART in bps
  47          
  48          //-----------------------------------------------------------------------------
  49          // Function PROTOTYPES
  50          //-----------------------------------------------------------------------------
  51          
  52          void SYSCLK_Init (void);
  53          void UART1_Init (void);
  54          void PORT_Init (void);
  55          void Timer2_Init (int);
C51 COMPILER V9.59.0.0   UART                                                              01/05/2024 11:16:31 PAGE 2   

  56          
  57          //-----------------------------------------------------------------------------
  58          // MAIN Routine
  59          //-----------------------------------------------------------------------------
  60          
  61          void main (void)
  62          {
  63   1         U8 inputcharacter;                  // Used to store character from UART
  64   1      
  65   1         SFRPAGE = ACTIVE_PAGE;
  66   1      
  67   1         PCA0MD &= ~0x40;                    // Disable watchdog timer
  68   1         PORT_Init();                        // Initialize Port I/O
  69   1         SYSCLK_Init ();                     // Initialize Oscillator
  70   1         UART1_Init();
  71   1      
  72   1         SFRPAGE = ACTIVE2_PAGE;             // Switch page for UART1 communication
  73   1      
  74   1         while (1)
  75   1         {
  76   2            //printf ("\nEnter character: ");
  77   2            //inputcharacter = getkey ();
  78   2                inputcharacter = 0x4E;
  79   2                printf ("%c",inputcharacter);
  80   2            //printf ("\nCharacter entered : %c",inputcharacter);
  81   2            //printf ("\n      Value in Hex: %bx",inputcharacter);
  82   2         }
  83   1      }
  84          
  85          //-----------------------------------------------------------------------------
  86          // Initialization Subroutines
  87          //-----------------------------------------------------------------------------
  88          //-----------------------------------------------------------------------------
  89          // PORT_Init
  90          //-----------------------------------------------------------------------------
  91          //
  92          // Return Value : None
  93          // Parameters   : None
  94          //
  95          // Configure the Crossbar and GPIO ports.
  96          //
  97          // P0.4   digital   push-pull    UART1 TX
  98          // P0.5   digital   open-drain   UART1 RX
  99          //
 100          //-----------------------------------------------------------------------------
 101          // void PORT_Init (void)
 102          // {
 103             // U8 SFRPAGE_save = SFRPAGE;
 104             // SFRPAGE = CONFIG_PAGE;
 105          
 106             // P0MDOUT |= 0x10;                    // Enable UART1 TX as push-pull output
 107             // P0SKIP  = 0x0F;                     // Skip to P0.4
 108          
 109             // XBR2    = 0x42;                     // Enable UART1 on P0.4(TX) and P0.5(RX)
 110                                                                                            //Enable crossbar and weak pull-ups
 111             // SFRPAGE = SFRPAGE_save;
 112          // }
 113          
 114          void PORT_Init (void)
 115          {
 116   1         U8 SFRPAGE_save = SFRPAGE;
 117   1         SFRPAGE = CONFIG_PAGE;
C51 COMPILER V9.59.0.0   UART                                                              01/05/2024 11:16:31 PAGE 3   

 118   1      
 119   1          P2MDOUT   = 0x01;
 120   1          P0SKIP    = 0xFF;
 121   1          P1SKIP    = 0xFF;
 122   1      
 123   1         XBR2    = 0x42;                     // Enable UART1 on P0.4(TX) and P0.5(RX)
 124   1                                             // Enable crossbar and weak pull-ups
 125   1         SFRPAGE = SFRPAGE_save;
 126   1      }
 127          
 128          //-----------------------------------------------------------------------------
 129          // SYSCLK_Init
 130          //-----------------------------------------------------------------------------
 131          //
 132          // Return Value : None
 133          // Parameters   : None
 134          //
 135          // This routine initializes the system clock to use the internal oscillator
 136          // at its maximum frequency.
 137          // Also enables the Missing Clock Detector.
 138          //-----------------------------------------------------------------------------
 139          
 140          void SYSCLK_Init (void)
 141          {
 142   1         U8 SFRPAGE_save = SFRPAGE;
 143   1         SFRPAGE = CONFIG_PAGE;
 144   1      
 145   1         OSCICN |= 0x87;                     // Configure internal oscillator for
 146   1                                             // its maximum frequency
 147   1         RSTSRC  = 0x04;                     // Enable missing clock detector
 148   1      
 149   1         SFRPAGE = SFRPAGE_save;
 150   1      }
 151          
 152          //-----------------------------------------------------------------------------
 153          // UART1_Init
 154          //-----------------------------------------------------------------------------
 155          //
 156          // Return Value : None
 157          // Parameters   : None
 158          //
 159          // Configure the UART1 using Timer1, for <BAUDRATE> and 8-N-1.
 160          //-----------------------------------------------------------------------------
 161          void UART1_Init (void)
 162          {
 163   1         U8 SFRPAGE_save = SFRPAGE;
 164   1         SFRPAGE = ACTIVE2_PAGE;
 165   1      
 166   1         SCON1 = 0x10;                       // SCON1: 8-bit variable bit rate
 167   1                                             //        level of STOP bit is ignored
 168   1                                             //        RX enabled
 169   1                                             //        ninth bits are zeros
 170   1                                             //        clear RI0 and TI0 bits
 171   1         if (SYSCLK / BAUDRATE / 2 / 256 < 1) 
 172   1         {
 173   2            TH1 = -(SYSCLK / BAUDRATE / 2);
 174   2            CKCON &= ~0x0B;                  // T1M = 1; SCA1:0 = xx
 175   2            CKCON |=  0x08;
 176   2         } 
 177   1         else if (SYSCLK / BAUDRATE / 2 / 256 < 4) 
 178   1         {
 179   2            TH1 = -(SYSCLK / BAUDRATE / 2 / 4);
C51 COMPILER V9.59.0.0   UART                                                              01/05/2024 11:16:31 PAGE 4   

 180   2            CKCON &= ~0x0B;                  // T1M = 0; SCA1:0 = 01
 181   2            CKCON |=  0x01;
 182   2         } 
 183   1         else if (SYSCLK / BAUDRATE / 2 / 256 < 12) 
 184   1         {
 185   2            TH1 = -(SYSCLK / BAUDRATE / 2 / 12);
 186   2            CKCON &= ~0x0B;                  // T1M = 0; SCA1:0 = 00
 187   2         } 
 188   1         else 
 189   1         {
 190   2            TH1 = -(SYSCLK / BAUDRATE / 2 / 48);
 191   2            CKCON &= ~0x0B;                  // T1M = 0; SCA1:0 = 10
 192   2            CKCON |=  0x02;
 193   2         }
 194   1      
 195   1         TL1 = TH1;                          // Init Timer1
 196   1         TMOD &= ~0xF0;                      // TMOD: timer 1 in 8-bit autoreload
 197   1         TMOD |=  0x20;
 198   1         TR1 = 1;                            // START Timer1
 199   1      
 200   1         TI1 = 1;                            // Indicate TX0 ready (SCON1)
 201   1      
 202   1         SFRPAGE = SFRPAGE_save;
 203   1      }
 204          
 205          //-----------------------------------------------------------------------------
 206          // End Of File
 207          //-----------------------------------------------------------------------------
*** WARNING C294 IN LINE 179 OF uart.c: unreachable code


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    102    ----
   CONSTANT SIZE    =      3    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----       1
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  1 WARNING(S),  0 ERROR(S)
